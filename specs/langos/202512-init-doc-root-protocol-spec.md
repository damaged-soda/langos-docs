# 文档目录初始化协议规格（init_doc_root）

- 状态：草稿
- 适用范围：langos 运行时新增的“初始化 doc_root 文档库”协议
- 最近更新：2025-12-11

## 背景与动机
- 现状：启动时仅校验 doc_root 是否存在，但未提供在目录不存在、为空或缺失关键子目录时的标准初始化流程。
- 问题：新环境或新项目常缺少基础文档骨架，导致后续协议（如需求/索引生成）无法落盘或需要人工补齐。
- 目标：提供一条可触发的协议，在 doc_root 不存在/为空/缺失关键子目录时，按规范生成文档骨架并更新配置。

## 目标与价值
- 快速建立符合 `langos-docs/meta/conventions.md` 的最小文档骨架，降低新环境接入成本。
- 在写入前明确状态、确认动作，避免误覆盖已有内容。
- 自动化配置写回（`.langos-local.yaml` 优先，其次 `.langos.yaml`），减少人工同步错误。

## 范围
- 处理 doc_root 为相对 langos 仓根的路径，场景覆盖：
  - doc_root 不存在；
  - doc_root 为空目录；
  - doc_root 存在但缺少约定子目录/README/索引。
- 产出：骨架目录与 README/INDEX 草稿、配置写回建议。

## 不包含
- 不清理或覆盖已有非空文件；遇到冲突需提示并由用户决策。
- 不生成具体业务内容（仅生成骨架和模板性 TODO）。
- 不处理多 doc_root 或远程存储场景。

## 触发与前置
- 触发示例语句：`初始化文档目录`、`doc_root 不存在`、`文档库是空的帮我建骨架`。
- 前置条件：
  - 用户提供或确认 doc_root 路径（相对 langos 仓根）。
  - 允许在该路径下创建/补齐目录与文件。
  - 允许更新 `.langos-local.yaml`（或 `.langos.yaml`）的 doc_root。

## 输入与输出
- 输入：
  - doc_root 路径及当前状态（不存在/为空/已有部分内容）。
  - 用户对“补齐缺失子目录/README”的确认。
  - 是否写回配置的确认。
- 输出：
  - 目录状态盘点（已存在内容/缺失项清单）。
  - 骨架计划清单与文件草稿（中文模板 + TODO 标记）。
  - 配置写回建议片段。
  - 未决/需人工补充的事项。

## 流程与确认点（拟定协议步骤）
1) 澄清（ASK_USER）
   - 确认 doc_root 路径、可写权限、是否允许创建/补齐。
   - 若目录已有内容，询问是否补齐缺失部分。
   - 询问是否要更新配置文件中的 doc_root。
2) 盘点（ANALYZE_DOCS）
   - 检查目录是否存在、是否为空、已有子目录/文件列表。
   - 标记缺失的关键子目录/README/INDEX。
3) 规划（PLAN_DOCS）
   - 提出将创建/补齐的骨架清单与用途说明。
   - 明示不会覆盖已有文件，冲突需人工确认。
4) 起草（DRAFT_DOCS）
   - 为各文件生成模板草稿（中文，含 TODO 提示），不直接写入。
5) 配置写回计划（PLAN_DOCS）
   - 给出 `.langos-local.yaml`（优先）或 `.langos.yaml` 的更新片段。
6) 确认与落盘（CONFIRM_AND_SUMMARIZE）
   - 列出将写入/创建的文件、配置更新内容、未决项。
   - 仅在用户确认后执行实际写入。

## 默认骨架与模板要点
- 根：`README.md`（说明文档库定位与导航）。
- 子目录与文件：
  - `repos/README.md`、`repos/INDEX.md`
  - `specs/README.md`
  - `projects/README.md`
  - `adr/README.md`
  - `domain/README.md`
  - `archive/README.md`
- 模板内容：简述目录职责、如何添加新文档、TODO 提示（如补充索引、规格、ADR 链接）。

## 安全与约束
- 全程中文，对路径/命令保持原文。
- 未经确认不得写入或覆盖文件；遇到已有内容需显式提示。
- 遵守 `runtime/conventions.md` 与 `langos-docs/meta/conventions.md` 的命名与结构要求。

## 验收标准
- 执行协议后：
  - 缺失的目录与 README/INDEX 按清单创建完成；未覆盖已有文件。
  - 生成的模板为中文，包含用途说明与 TODO。
  - `.langos-local.yaml`（或 `.langos.yaml`）中的 doc_root 更新与实际路径一致（若用户同意）。
  - 未决事项清晰列出。

## 待决与后续
- 是否需要 CLI 校验脚本（如 lint 目录结构）暂不纳入本协议。
- 若未来支持多 doc_root 或远程存储，需要补充适配场景。
