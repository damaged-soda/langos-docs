# doc_root 版本化与校验规范
Status: active
Since: 2025-12
Target: langos runtime 文档库（doc_root）

## 背景与目标
- 运行时依赖 doc_root 的结构化信息（蓝图、索引、spec 等）进行治理/开发，缺乏版本定义会导致规范不一致。
- 目标：为 doc_root 建立可识别的版本号、硬性目录/命名/格式约束，并提供校验与升级路径，方便 AI 快速判断与引导。
- 内容正确性不在本规范范围内；本规范仅约束文档库的组织与格式。内容与项目匹配由其他协议负责。

## 适用范围
- 适用于被 langos 运行时操作的 doc_root。
- 默认 doc_root 指向 `../langos-docs/`，但规范适用于任意 doc_root 实例。
- 不覆盖代码仓（../langos/）内的协议/规范文件。
- 运行时内需保留一份独立的 doc_root 标准摘要（SOT 副本），便于在多 doc_root 或 doc_root 缺失时仍可对照与引导，而不依赖 docs 仓内容。当前实现位于 `langos/runtime/doc-root-standard.yaml`（standard_version: v0.0.0）。

## 版本号定义与存放
- 版本号声明位置：doc_root 根 `README.md` 开头必须出现如下段落：
  ```
  Doc Root Version: vX.Y.Z
  Last Updated: YYYY-MM-DD
  ```
  - 版本号使用 `v<MAJOR>.<MINOR>.<PATCH>`，至少 MAJOR/MINOR。
- 运行时读取方式：启动或需要校验时，读取 doc_root 根 README 的上述字段；若缺失，提示用户执行校验协议或补充版本号。
- 版本号含义：
  - MAJOR：不兼容变化（目录/命名/元信息规则变化）。
  - MINOR：向后兼容的新增或补充。
  - PATCH：小修补充，对结构无破坏性影响。

## 目录与命名硬规则
- 目录职责（沿用现有 conventions，视为强制）：
  - `blueprints/` 愿景与顶层蓝图；不存具体需求。
  - `repos/` 项目索引与单仓概览；每仓一个 `repos/<name>.md`；索引为 `repos/INDEX.md`。
  - `specs/` 需求/设计规格；跨仓放根 specs/；单仓放 `specs/<repo>/`。
  - `projects/` 跨仓或阶段性项目文档。
  - `adr/` 架构决策记录。
  - `domain/` 术语、数据模型。
  - `meta/` 文档库自身治理与规范。
  - `archive/` 归档，需注明原路径/原因/日期/替代。
- 命名（引用 `meta/conventions.md`，此处重申关键硬规则）：
  - 规格：`YYYYMMDD-topic-spec.md`（设计/方案可用 `...-design-spec.md`/`...-solution-spec.md`）。
  - ADR：`YYYYMMDD-short-name.md`。
  - 项目目录：`YYYYMM-project-name/`。
  - 统一使用小写+数字+连字符。
- 文档内元信息（规格/ADR 强制）：
  - 顶部需含 `Status`（draft/active/implemented/superseded/archived）、`Since`（YYYY-MM），必要时 `Supersedes`/`Superseded-by`/`Related-ADR`。
  - 规格正文至少包含：背景/目标、范围、约束、方案或规则、迁移/升级指引、风险或非目标。

## 兼容性与升级
- 版本不兼容：版本号不同视为不兼容，除非在“升级指引”中声明兼容。
- 升级指引要求：
  - 每次发布新版本，必须在新版本文档中增加“从 vX.Y.Z 升级到 vX'.Y'.Z'”的步骤或检查单。
  - 因仅保留最新标准，历史规则不再完整保存；升级指引需包含所需的目录调整、命名修复、元信息补全等操作。
- 运行时提示：
  - 检测到版本号缺失或小于当前版本时，先提示用户参考升级指引；用户确认后可调用“升级”协议执行自动/半自动修复。
  - 若版本号高于运行时已知版本，提示可能存在未知规则，建议人工核对或更新运行时。

## 协议需求
- **doc_root 校验协议（新增）**
  - 触发：用户主动请求校验，或运行时发现版本号缺失。
  - 行为：读取版本号 → 对照当前版本的目录/命名/元信息规则 → 全量扫描目录与文档（可能耗时）→ 给出差异列表与修复建议。
  - 默认信任已有版本号，不自动全量检查；缺失或用户要求时才执行。
- **doc_root 升级/修复协议（新增）**
  - 触发：校验发现版本低/缺失，或用户请求升级。
  - 行为：查找新版本的“升级指引”，按步骤执行；如版本号正确但存在偏差，则给个性化修复建议并征求确认后落盘。
  - 如无可用指引（旧版本规则缺失），需告知无法自动迁移，改为列举差异并让用户确认手动修正或生成个性化 patch。

## 非目标与风险
- 不涵盖内容正确性或项目匹配度；仅约束结构与格式，内容校验由其他协议负责。
- 不涵盖代码仓规范、运行时协议细节；仅针对 doc_root。
- 全量校验可能耗时，默认不自动执行；需用户确认。
- 由于仅保留最新标准，对更早版本的自动迁移能力有限，需依赖升级指引或人工确认。

## TODO / 开放问题
- 校验粒度与性能优化（是否支持增量校验或采样校验）。
- 运行时与协议的具体实现细节（路由意图、步骤拆解、输出格式）需另行补充。
- 是否需要在 doc_root 内保留一个简易 manifest 文件（除了 README 段落），以便程序化解析与校验缓存。
